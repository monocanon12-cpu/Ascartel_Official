<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test API ASCARTEL - Pour D√©butants</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f5f5;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    h1 {
      color: #1a1a2e;
      margin-bottom: 10px;
    }
    
    .intro {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin-bottom: 30px;
      border-radius: 0 8px 8px 0;
    }
    
    .section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .section h2 {
      color: #1a1a2e;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section h2 .icon {
      background: #f68db5;
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn {
      background: #f68db5;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      margin: 5px;
      transition: all 0.3s;
    }
    
    .btn:hover {
      background: #e85d9a;
      transform: translateY(-2px);
    }
    
    .btn-blue {
      background: #3b82f6;
    }
    
    .btn-blue:hover {
      background: #2563eb;
    }
    
    .btn-green {
      background: #22c55e;
    }
    
    .btn-green:hover {
      background: #16a34a;
    }
    
    .result-box {
      background: #1a1a2e;
      color: #a0aec0;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    .result-box .success {
      color: #4ade80;
    }
    
    .result-box .error {
      color: #f87171;
    }
    
    .result-box .info {
      color: #60a5fa;
    }
    
    .login-form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .login-form input {
      padding: 10px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      flex: 1;
      min-width: 200px;
    }
    
    .login-form input:focus {
      outline: none;
      border-color: #f68db5;
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .status-connected {
      background: #dcfce7;
      color: #16a34a;
    }
    
    .status-disconnected {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .explanation {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 12px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
      font-size: 0.9rem;
    }
    
    .code-example {
      background: #f8f9fa;
      border: 1px solid #e5e7eb;
      padding: 12px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.85rem;
      margin: 10px 0;
      overflow-x: auto;
    }
    
    .articles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .article-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      border: 1px solid #e5e7eb;
    }
    
    .article-card h4 {
      color: #1a1a2e;
      margin-bottom: 8px;
    }
    
    .article-card .price {
      font-size: 1.2rem;
      font-weight: 700;
      color: #f68db5;
    }
    
    .article-card .old-price {
      text-decoration: line-through;
      color: #9ca3af;
      font-size: 0.9rem;
      margin-left: 8px;
    }
    
    .article-card .flash-badge {
      background: #ef4444;
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .article-card .stock {
      font-size: 0.85rem;
      color: #6b7280;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test API ASCARTEL</h1>
    <p style="color: #6b7280; margin-bottom: 20px;">Page de d√©monstration pour comprendre comment fonctionne l'API</p>
    
    <div class="intro">
      <strong>üí° C'est quoi une API ?</strong><br>
      Une API (Application Programming Interface) permet √† votre site web (frontend) de communiquer avec le serveur (backend) pour r√©cup√©rer ou envoyer des donn√©es. C'est comme un serveur de restaurant : vous passez commande (requ√™te), et il vous apporte les plats (donn√©es).
    </div>

    <!-- Section 1: Statut -->
    <div class="section">
      <h2><span class="icon">1</span> V√©rifier si l'API fonctionne</h2>
      <p>Cliquez sur le bouton pour voir si le serveur backend r√©pond :</p>
      
      <div class="explanation">
        <strong>üîç Ce qui se passe :</strong> On envoie une requ√™te GET √† <code>http://localhost:3000/api/health</code>
      </div>
      
      <button class="btn" onclick="testHealth()">Tester la connexion API</button>
      <div id="healthResult" class="result-box">En attente du test...</div>
    </div>

    <!-- Section 2: Articles -->
    <div class="section">
      <h2><span class="icon">2</span> R√©cup√©rer les articles</h2>
      <p>R√©cup√©rez la liste des articles depuis la base de donn√©es :</p>
      
      <div class="explanation">
        <strong>üîç Ce qui se passe :</strong> On envoie une requ√™te GET √† <code>http://localhost:3000/api/articles</code>
      </div>
      
      <button class="btn btn-blue" onclick="getArticles()">Voir tous les articles</button>
      <button class="btn btn-green" onclick="getFlashSales()">Voir les ventes flash üî•</button>
      
      <div id="articlesDisplay" class="articles-grid"></div>
      <div id="articlesResult" class="result-box" style="display: none;"></div>
    </div>

    <!-- Section 3: Connexion Admin -->
    <div class="section">
      <h2><span class="icon">3</span> Connexion Admin</h2>
      <p>Connectez-vous en tant qu'administrateur pour acc√©der aux fonctions prot√©g√©es :</p>
      
      <div class="explanation">
        <strong>üîê Identifiants Admin :</strong><br>
        Email: <code>master@ascartel.com</code><br>
        Mot de passe: <code>ASCARTEL_MASTER_2025</code>
      </div>
      
      <div class="login-form">
        <input type="email" id="loginEmail" placeholder="Email" value="master@ascartel.com">
        <input type="password" id="loginPassword" placeholder="Mot de passe" value="ASCARTEL_MASTER_2025">
        <button class="btn btn-green" onclick="login()">Se connecter</button>
      </div>
      
      <p>Statut: <span id="loginStatus" class="status-badge status-disconnected">Non connect√©</span></p>
      <div id="loginResult" class="result-box">En attente de connexion...</div>
    </div>

    <!-- Section 4: Actions Admin -->
    <div class="section">
      <h2><span class="icon">4</span> Actions Admin (apr√®s connexion)</h2>
      <p>Ces actions n√©cessitent d'√™tre connect√© en tant qu'Admin :</p>
      
      <div class="explanation">
        <strong>‚ö†Ô∏è Important :</strong> Vous devez d'abord vous connecter (√©tape 3) pour que ces boutons fonctionnent.
      </div>
      
      <button class="btn" onclick="getSettings()">Voir les param√®tres</button>
      <button class="btn btn-blue" onclick="toggleStore(true)">Ouvrir la boutique</button>
      <button class="btn" style="background: #ef4444;" onclick="toggleStore(false)">Fermer la boutique</button>
      
      <div id="adminResult" class="result-box">Connectez-vous d'abord...</div>
    </div>

    <!-- Section 5: Statut Boutique -->
    <div class="section">
      <h2><span class="icon">5</span> Statut de la boutique (public)</h2>
      <p>V√©rifiez si la boutique est ouverte (selon les horaires) :</p>
      
      <button class="btn btn-blue" onclick="getStoreStatus()">V√©rifier le statut</button>
      <div id="storeResult" class="result-box">Cliquez pour v√©rifier...</div>
    </div>

    <!-- Section: Code -->
    <div class="section">
      <h2><span class="icon">üìù</span> Exemple de code √† copier</h2>
      <p>Voici comment faire un appel API dans votre code JavaScript :</p>
      
      <div class="code-example">
<pre>// R√©cup√©rer les articles
async function chargerArticles() {
  const response = await fetch('http://localhost:3000/api/articles');
  const data = await response.json();
  
  console.log(data.articles); // Liste des articles
  
  // Afficher chaque article
  data.articles.forEach(article => {
    console.log(article.nom, article.prix);
  });
}</pre>
      </div>
    </div>
  </div>

  <script>
    // URL de l'API Backend
    const API_URL = 'http://localhost:3000/api';
    
    // Token de connexion (stock√© apr√®s login)
    let authToken = null;

    // =============================================
    // FONCTIONS DE TEST
    // =============================================

    // 1. Tester si l'API r√©pond
    async function testHealth() {
      const resultBox = document.getElementById('healthResult');
      resultBox.innerHTML = '<span class="info">‚è≥ Envoi de la requ√™te...</span>';
      
      try {
        const response = await fetch(`${API_URL}/health`);
        const data = await response.json();
        
        resultBox.innerHTML = `<span class="success">‚úÖ API CONNECT√âE !</span>\n\n` +
          `Message: ${data.message}\n` +
          `Version: ${data.version}\n` +
          `Heure serveur: ${data.timestamp}`;
      } catch (error) {
        resultBox.innerHTML = `<span class="error">‚ùå ERREUR: L'API ne r√©pond pas</span>\n\n` +
          `V√©rifiez que le serveur backend est lanc√©.\n` +
          `Commande: cd backend && npm start`;
      }
    }

    // 2. R√©cup√©rer les articles
    async function getArticles() {
      const resultBox = document.getElementById('articlesResult');
      const displayBox = document.getElementById('articlesDisplay');
      resultBox.style.display = 'none';
      displayBox.innerHTML = '<p>‚è≥ Chargement...</p>';
      
      try {
        const response = await fetch(`${API_URL}/articles`);
        const data = await response.json();
        
        if (data.success) {
          displayArticles(data.articles, displayBox);
        }
      } catch (error) {
        displayBox.innerHTML = `<p style="color: red;">‚ùå Erreur: ${error.message}</p>`;
      }
    }

    // 2b. R√©cup√©rer les ventes flash
    async function getFlashSales() {
      const displayBox = document.getElementById('articlesDisplay');
      displayBox.innerHTML = '<p>‚è≥ Chargement des ventes flash...</p>';
      
      try {
        const response = await fetch(`${API_URL}/articles/flash-sales`);
        const data = await response.json();
        
        if (data.success) {
          displayArticles(data.articles, displayBox, true);
        }
      } catch (error) {
        displayBox.innerHTML = `<p style="color: red;">‚ùå Erreur: ${error.message}</p>`;
      }
    }

    // Afficher les articles en cartes
    function displayArticles(articles, container, isFlash = false) {
      if (articles.length === 0) {
        container.innerHTML = '<p>Aucun article trouv√©.</p>';
        return;
      }
      
      container.innerHTML = articles.map(article => `
        <div class="article-card">
          ${article.flash_sale.active ? '<span class="flash-badge">üî• FLASH -' + article.flash_sale.discount + '%</span>' : ''}
          <h4>${article.nom}</h4>
          <p>${article.categorie || 'Sans cat√©gorie'}</p>
          <p>
            <span class="price">${article.prix.toLocaleString()} Ar</span>
            ${article.flash_sale.active ? `<span class="old-price">${article.prix_original.toLocaleString()} Ar</span>` : ''}
          </p>
          <p class="stock">Stock: ${article.stock} ${article.stock_faible ? '‚ö†Ô∏è Stock faible' : ''}</p>
        </div>
      `).join('');
    }

    // 3. Connexion
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const resultBox = document.getElementById('loginResult');
      const statusBadge = document.getElementById('loginStatus');
      
      resultBox.innerHTML = '<span class="info">‚è≥ Connexion en cours...</span>';
      
      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          authToken = data.token;
          statusBadge.textContent = `Connect√©: ${data.user.name} (${data.user.role})`;
          statusBadge.className = 'status-badge status-connected';
          
          resultBox.innerHTML = `<span class="success">‚úÖ CONNEXION R√âUSSIE !</span>\n\n` +
            `Utilisateur: ${data.user.name}\n` +
            `Email: ${data.user.email}\n` +
            `R√¥le: ${data.user.role}\n\n` +
            `Token JWT (pour les requ√™tes prot√©g√©es):\n${data.token.substring(0, 50)}...`;
        } else {
          resultBox.innerHTML = `<span class="error">‚ùå √âCHEC: ${data.error}</span>`;
        }
      } catch (error) {
        resultBox.innerHTML = `<span class="error">‚ùå Erreur: ${error.message}</span>`;
      }
    }

    // 4. Actions Admin
    async function getSettings() {
      const resultBox = document.getElementById('adminResult');
      
      if (!authToken) {
        resultBox.innerHTML = '<span class="error">‚ùå Vous devez d\'abord vous connecter !</span>';
        return;
      }
      
      resultBox.innerHTML = '<span class="info">‚è≥ R√©cup√©ration des param√®tres...</span>';
      
      try {
        const response = await fetch(`${API_URL}/settings`, {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultBox.innerHTML = `<span class="success">‚úÖ PARAM√àTRES R√âCUP√âR√âS</span>\n\n` +
            JSON.stringify(data.settings, null, 2);
        } else {
          resultBox.innerHTML = `<span class="error">‚ùå ${data.error}</span>`;
        }
      } catch (error) {
        resultBox.innerHTML = `<span class="error">‚ùå Erreur: ${error.message}</span>`;
      }
    }

    async function toggleStore(open) {
      const resultBox = document.getElementById('adminResult');
      
      if (!authToken) {
        resultBox.innerHTML = '<span class="error">‚ùå Vous devez d\'abord vous connecter !</span>';
        return;
      }
      
      try {
        const response = await fetch(`${API_URL}/settings/store`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ open })
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultBox.innerHTML = `<span class="success">‚úÖ ${data.message}</span>`;
        } else {
          resultBox.innerHTML = `<span class="error">‚ùå ${data.error}</span>`;
        }
      } catch (error) {
        resultBox.innerHTML = `<span class="error">‚ùå Erreur: ${error.message}</span>`;
      }
    }

    // 5. Statut boutique
    async function getStoreStatus() {
      const resultBox = document.getElementById('storeResult');
      resultBox.innerHTML = '<span class="info">‚è≥ V√©rification...</span>';
      
      try {
        const response = await fetch(`${API_URL}/settings/status`);
        const data = await response.json();
        
        if (data.success) {
          const store = data.store;
          resultBox.innerHTML = `<span class="${store.open ? 'success' : 'error'}">${store.open ? '‚úÖ BOUTIQUE OUVERTE' : '‚ùå BOUTIQUE FERM√âE'}</span>\n\n` +
            `Message: ${store.message}\n` +
            `Horaires: ${store.hours.opening}h - ${store.hours.closing}h\n` +
            `Heure actuelle: ${store.currentHour}h`;
        }
      } catch (error) {
        resultBox.innerHTML = `<span class="error">‚ùå Erreur: ${error.message}</span>`;
      }
    }

    // Test automatique au chargement
    window.onload = function() {
      testHealth();
    };
  </script>
</body>
</html>
